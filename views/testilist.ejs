<!DOCTYPE html>
<head lang="en">
    <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KS9SLJPS9N"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-KS9SLJPS9N');
    </script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script>
        function validateForm() {
            var recaptchaResponse = grecaptcha.getResponse();
            if (recaptchaResponse.length === 0) {
                alert("Please complete the reCAPTCHA.");
                return false;
            }
            return true;
        }
    </script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="/js/loadmore.js"></script>
    <link rel="icon" sizes="32x32" href="./images/favicon.png" type="image/png">
    <link rel="icon" sizes="48x48" href="./images/favicon.png" type="image/png">
    <link rel="icon" sizes="64x64" href="./images/favicon.png" type="image/png">

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>Maison Infratech - Testimonial Dashboard</title>
    <meta name="description" content="Explore a wide range of residential and commercial projects in Gurgaon. Find the best deals and detailed information on properties offered by Maison Infratech.">
    <meta name="keywords" content="real estate consultancy,real estate advisors, real estate realtor, Gurgaon real estate, property investment, buy luxury property, 3bhk flats, 2bhk flats, 4bhk flats, buy property in Gurgaon, Maison Infratech, Buy flat in gurgaon, gurgaon property prices, Residential properties, Commertial properties" />
    <link rel="canonical" href="https://maisoninfratech.in/testimonials" />
    <meta property="og:title" content="Maison Infratech - Residential & Commercial Properties in Gurgaon" />
    <meta property="og:description" content="Explore a wide range of residential and commercial projects in Gurgaon. Find the best deals and detailed information on properties offered by Maison Infratech." />
    <meta property="og:url" content="https://maisoninfratech.in/testimonials" />
    <meta property="og:image" content="https://maisoninfratech.in/images/maison-new-logo1.jpg" />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="alternate" hreflang="en" href="https://maisoninfratech.in/testimonials" />
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "RealEstateAgent",
          "name": "Maison Infratech",
          "url": "https://maisoninfratech.in/testimonials",
          "logo": "https://maisoninfratech.in/images/maison-new-logo1.jpg",
          "sameAs": [
            "https://www.facebook.com/MaisonInfratechOfficial",
            "https://www.instagram.com/maisoninfratechofficial/",
            "https://in.linkedin.com/company/maison-infratech-pvt-ltd"
          ],
          "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+91-9999156255",
            "contactType": "Customer Service"
          },
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Unit No. 610-617, Tower A Spaze 1 Tech Park Sohna Road Sector 49",
            "addressLocality": "Gurgaon",
            "addressRegion": "HR",
            "postalCode": "122018",
            "addressCountry": "IN"
          }
        }
        </script>
    <link rel="stylesheet" href="/css/swiper-bundle.min.css" />
    <link rel="stylesheet" href="/css/property.css">
    <link rel="stylesheet" href="/css/index.css" />

    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/intlTelInput.css">
    <link rel="stylesheet" href="/css/intlTelInput.min.css">
    <script src="https://kit.fontawesome.com/9c5eb2a5cc.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <!-- <script src="js/loadMoreProjects.js"></script> -->
</head>
<%- include("partials/navbar"); -%>

<div class="container">
    <h1 style="text-align: center;">Testimonials</h1>
    <!-- Button to add new testimonial -->
    <button type="button" class="btn btn-primary" style="margin-bottom: 10px;">
        <a href="/addtestimonial" style="text-decoration: none; color: white;">Add New Testimonial</a>
    </button>

    <!-- List of existing testimonials -->
    <% testimonials.forEach(testimonial => { %>
        <div class="card" style="margin-bottom: 20px;">
            <div class="card-body">
                <!-- Testimonial image -->
                <img src="/uploads/<%= testimonial.image %>" class="img-fluid" style="max-height: 200px; margin-bottom: 10px;">
                <!-- Testimonial name -->
                <h5 class="card-title"><%= testimonial.name %></h5>
                <!-- Buttons for editing, deleting, listing, and delisting -->
                <div class="btn-group" role="group">
                    <a href="/edit-testimonial/<%= testimonial._id %>" class="btn btn-primary">Edit</a>
                    <button type="button" class="btn btn-danger delete-btn" data-id="<%= testimonial._id %>">Delete</button>
                    <% if (testimonial.state) { %>
                        <!-- Delist button if testimonial is listed -->
                        <button type="button" class="btn btn-warning delist-btn" data-id="<%= testimonial._id %>">Delist</button>
                    <% } else { %>
                        <!-- List button if testimonial is delisted -->
                        <button type="button" class="btn btn-success list-btn" data-id="<%= testimonial._id %>">List</button>
                    <% } %>
                </div>
            </div>
        </div>
    <% }); %>
</div>

<script>

    // Function to handle AJAX request for deleting testimonial
    function deleteTestimonial(id) {
        fetch(`/delete-testimonial/${id}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            // Handle success response
            console.log('Testimonial deleted successfully');
            window.location.reload();
        })
        .catch(error => {
            // Handle error
            console.error('Error:', error);
        });
    }

    // Function to handle AJAX request for listing or delisting testimonial
    // Function to handle AJAX request for listing or delisting testimonial
function listOrDelistTestimonial(id, action) {
    let endpoint;
    if (action === 'list') {
        endpoint = `/list-testimonial/${id}`;
    } else if (action === 'delist') {
        endpoint = `/delist-testimonial/${id}`;
    }

    fetch(endpoint, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // Handle success response
        console.log(`Testimonial ${action === 'list' ? 'listed' : 'delisted'} successfully`);
        window.location.reload();
    })
    .catch(error => {
        // Handle error
        console.error('Error:', error);
    });
}


    // Add event listeners for edit, delete, list, and delist buttons
    document.addEventListener('DOMContentLoaded', () => {
        const editButtons = document.querySelectorAll('.edit-btn');
        const deleteButtons = document.querySelectorAll('.delete-btn');
        const listButtons = document.querySelectorAll('.list-btn');
        const delistButtons = document.querySelectorAll('.delist-btn');

        editButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.dataset.id;
                editTestimonial(id);
            });
        });

        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.dataset.id;
                deleteTestimonial(id);
            });
        });

        listButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.dataset.id;
                listOrDelistTestimonial(id, 'list');
            });
        });

        delistButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.dataset.id;
                listOrDelistTestimonial(id, 'delist');
            });
        });
    });
</script>
